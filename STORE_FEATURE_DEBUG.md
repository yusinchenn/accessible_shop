# 商家功能調試指南

## 問題：在搜尋結果和商品詳情中看不到商家資訊

### 可能的原因

1. **資料庫尚未重新初始化** ⚠️ （最可能）
2. 程式碼編譯問題
3. 資料載入邏輯錯誤

---

## 解決步驟

### 步驟 1: 確認程式碼已生成 ✅

檢查以下檔案是否存在：
- `lib/models/store.g.dart` ✅ 已存在
- `lib/models/product.g.dart` 中包含 `storeId` ✅ 已確認

### 步驟 2: 重新初始化資料庫 ⚠️ **重要**

**舊的測試資料不包含商家資訊！您需要重新初始化。**

#### 方法 1: 使用 Dev Tools 頁面（推薦）
1. 開啟應用程式
2. 進入 **Dev Tools** 頁面（開發工具）
3. 找到 **"初始化測試資料"** 按鈕
4. 點擊按鈕執行初始化
5. 等待顯示 "✅ 所有測試資料已初始化完成"

#### 方法 2: 清除應用程式資料
1. 在手機/模擬器上長按應用程式圖標
2. 選擇 "應用程式資訊"
3. 選擇 "儲存空間"
4. 點擊 "清除資料"
5. 重新啟動應用程式
6. 登入後，進入 Dev Tools 初始化測試資料

---

## 驗證步驟

### 驗證 1: 檢查資料庫統計
在 Dev Tools 頁面中查看資料庫統計：
- ✅ 商家數量: **3**
- ✅ 商品數量: **20**

如果商家數量為 0，請執行步驟 2。

### 驗證 2: 檢查商品的 storeId
測試資料中的商品應該都有 storeId：
- 商家 1（運動世界專賣店）：7 個商品
- 商家 2（健身器材專賣店）：7 個商品
- 商家 3（戶外探險家）：6 個商品

### 驗證 3: 測試搜尋頁面
1. 搜尋任何商品（例如：Nike）
2. 在商品卡片上應該看到：
   ```
   商品名稱
   $價格
   🏪 商家名稱 ← 應該在這裡顯示
   商品描述...
   ```

### 驗證 4: 測試商品詳情頁面
1. 進入任何商品的詳情頁面
2. 在商品名稱下方應該看到：
   ```
   商品名稱
   🏪 商家名稱 ⭐ 4.8 ← 應該在這裡顯示
   $價格
   ```

---

## 調試輸出

### 搜尋頁面的 Console 輸出

正常情況下，您應該在 console 看到：
```
🔍 [SearchPage] 開始搜尋關鍵字: "Nike"
🔍 [SearchPage] 搜尋結果數量: 2
🔍 [SearchPage] 載入商家數量: 3
🔍 [SearchPage] 前 3 筆結果:
   1. Nike Air Max 270 (分類: 運動鞋, 商家: 運動世界專賣店)
   2. Nike Dri-FIT 運動短褲 (分類: 運動服飾, 商家: 運動世界專賣店)
```

如果看不到 "載入商家數量: 3"，表示資料庫中沒有商家資料。

---

## 程式碼檢查清單

以下程式碼已確認正確：

### ✅ 1. Store 模型
- 檔案：`lib/models/store.dart`
- 包含：name, rating, followersCount, imageUrl, description

### ✅ 2. Product 模型
- 檔案：`lib/models/product.dart:14`
- 包含：`late int storeId;`

### ✅ 3. DatabaseService
- 檔案：`lib/services/database_service.dart`
- 已註冊 StoreSchema
- 已實作 getStores(), getStoreById(), getProductsByStoreId()

### ✅ 4. 測試資料
- 檔案：`lib/services/test_data_service.dart`
- 3 個商家資料（387-411 行）
- 20 個商品資料，每個都有 storeId（85-251 行）

### ✅ 5. 搜尋頁面
- 檔案：`lib/pages/search/search_page.dart`
- 載入商家資料（60-62 行）
- 傳遞 storeName 給 ProductCard（207 行）
- 傳遞 onStoreDoubleTap 回調（208-217 行）

### ✅ 6. ProductCard Widget
- 檔案：`lib/widgets/product_card.dart`
- 接收 storeName 參數（10 行）
- 顯示商家名稱（59-84 行）
- 支援雙擊導航（62 行）

### ✅ 7. 商品詳情頁面
- 檔案：`lib/pages/product/product_detail_page.dart`
- 載入商家資料（60-63 行）
- 顯示商家資訊（427-473 行）
- 支援雙擊導航（431-437 行）

### ✅ 8. 路由配置
- 檔案：`lib/main.dart`
- 已註冊 /store 動態路由（315-328 行）

---

## 測試案例

### 測試案例 1: Nike Air Max 270
- **商品 ID**: 1
- **商家**: 運動世界專賣店 (storeId: 1)
- **預期結果**: 在搜尋和詳情頁面都能看到商家名稱

### 測試案例 2: 啞鈴組合
- **商品 ID**: 8
- **商家**: 健身器材專賣店 (storeId: 2)
- **預期結果**: 在搜尋和詳情頁面都能看到商家名稱

### 測試案例 3: 登山背包 40L
- **商品 ID**: 15
- **商家**: 戶外探險家 (storeId: 3)
- **預期結果**: 在搜尋和詳情頁面都能看到商家名稱

---

## 最可能的解決方案

**99% 的可能性是因為資料庫還沒有重新初始化。**

請執行以下步驟：
1. 開啟應用程式
2. 進入 Dev Tools 頁面
3. 點擊 "初始化測試資料" 按鈕
4. 重新測試搜尋功能

初始化完成後，您應該立即能在搜尋結果和商品詳情中看到商家資訊！